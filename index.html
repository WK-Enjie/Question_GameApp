<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Singapore Curriculum Quiz Game</title>
    <style>
        /* RESET */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        
        /* CONTAINER */
        .container {
            width: 100%;
            max-width: 550px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        /* SCREEN */
        .screen {
            padding: 30px 25px;
            width: 100%;
            display: none;
        }
        
        .screen.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* HEADER */
        .header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .header h1 {
            font-size: 1.8rem;
            color: #4cc9f0;
            margin-bottom: 8px;
        }
        
        .header p {
            color: #a0aec0;
            font-size: 1rem;
        }
        
        /* 6-DIGIT PIN DISPLAY */
        .pin-display {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .pin-digit {
            width: 55px;
            height: 75px;
            background: rgba(255, 255, 255, 0.05);
            border: 3px solid #4cc9f0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            font-weight: bold;
            color: #4cc9f0;
        }
        
        .pin-separator {
            display: flex;
            align-items: center;
            color: #a0aec0;
            font-size: 1.5rem;
            margin: 0 2px;
        }
        
        /* PIN GUIDE */
        .pin-guide {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #fbbf24;
        }
        
        .pin-guide h4 {
            color: #fbbf24;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .pin-format {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .pin-group {
            text-align: center;
            margin: 0 5px;
        }
        
        .pin-label {
            width: 55px;
            text-align: center;
            font-size: 0.85rem;
            color: #a0aec0;
            margin-bottom: 3px;
        }
        
        .pin-label span {
            display: block;
            color: #4cc9f0;
            font-weight: bold;
            margin-bottom: 2px;
            font-size: 0.9rem;
        }
        
        .group-label {
            color: #48bb78;
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 5px;
        }
        
        /* HIDDEN WORKSHEETS PANEL */
        .hidden-worksheets {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .hidden-worksheets h4 {
            color: #fbbf24;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .hidden-code-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }
        
        .hidden-code-item {
            padding: 8px 12px;
            background: rgba(245, 101, 101, 0.2);
            border: 1px solid #f56565;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9rem;
            color: #f56565;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .hidden-code-item:hover {
            background: rgba(245, 101, 101, 0.3);
        }
        
        .show-hidden-btn {
            width: 100%;
            padding: 10px;
            background: rgba(245, 101, 101, 0.2);
            border: 1px solid #f56565;
            border-radius: 8px;
            color: #f56565;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .show-hidden-btn:hover {
            background: rgba(245, 101, 101, 0.3);
        }
        
        /* KEYPAD */
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .keypad-btn {
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 1.5rem;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .keypad-btn:active {
            background: rgba(76, 201, 240, 0.3);
            transform: scale(0.98);
        }
        
        .keypad-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .keypad-actions button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .clear-btn {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: white;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }
        
        /* QUIZ CATALOG */
        .quiz-catalog {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .quiz-catalog h3 {
            text-align: center;
            color: #a0aec0;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .level-section {
            margin-bottom: 20px;
        }
        
        .level-title {
            color: #4cc9f0;
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid rgba(76, 201, 240, 0.3);
        }
        
        .quiz-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
            gap: 8px;
        }
        
        .quiz-item {
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .quiz-item.hidden {
            opacity: 0.5;
            background: rgba(245, 101, 101, 0.1);
            border: 1px solid rgba(245, 101, 101, 0.3);
        }
        
        .quiz-item.hidden::after {
            content: 'üîí';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.8rem;
        }
        
        .quiz-item:hover:not(.hidden) {
            background: rgba(76, 201, 240, 0.1);
            border-color: #4cc9f0;
        }
        
        .quiz-code {
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .quiz-name {
            font-size: 0.85rem;
            margin-bottom: 3px;
            line-height: 1.3;
        }
        
        .quiz-meta {
            font-size: 0.75rem;
            color: #a0aec0;
        }
        
        /* LOADING SCREEN */
        .loader {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(76, 201, 240, 0.1);
            border-top-color: #4cc9f0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            text-align: center;
            color: #a0aec0;
            font-size: 1.2rem;
        }
        
        /* GAME SCREEN */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .quiz-title {
            font-size: 1.4rem;
            color: #4cc9f0;
        }
        
        .home-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .players {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .player {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid transparent;
        }
        
        .player.active {
            border-color: #4cc9f0;
            background: rgba(76, 201, 240, 0.1);
        }
        
        .player h3 {
            color: #a0aec0;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .score {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4cc9f0;
        }
        
        .question-info {
            display: flex;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 1rem;
        }
        
        .question-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .question {
            font-size: 1.4rem;
            line-height: 1.5;
            margin-bottom: 25px;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            padding: 18px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.1rem;
        }
        
        .option:active {
            background: rgba(76, 201, 240, 0.2);
        }
        
        .option.selected {
            background: rgba(76, 201, 240, 0.2);
            border-color: #4cc9f0;
        }
        
        .answer-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #48bb78, #38a169);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .answer-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .feedback {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            font-size: 1.1rem;
            line-height: 1.5;
        }
        
        .treasure-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: center;
        }
        
        .treasure-section h3 {
            color: #4cc9f0;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .treasure-boxes {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .treasure-box {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #fbbf24, #d97706);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .treasure-box:active {
            transform: scale(0.95);
        }
        
        .next-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #4cc9f0, #4361ee);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* GAME OVER */
        .game-over {
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-top: 20px;
        }
        
        /* ERROR SCREEN */
        .error-icon {
            text-align: center;
            font-size: 4rem;
            color: #f56565;
            margin: 20px 0;
        }
        
        .error-text {
            text-align: center;
            color: #a0aec0;
            margin: 20px 0;
            line-height: 1.5;
        }
        
        .error-actions {
            display: flex;
            gap: 12px;
            margin-top: 30px;
        }
        
        .error-actions button {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .retry-btn {
            background: #48bb78;
            color: white;
        }
        
        .back-btn {
            background: #4cc9f0;
            color: white;
        }
        
        /* ADMIN PANEL */
        .admin-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .admin-toggle {
            background: #f56565;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .admin-menu {
            display: none;
            position: absolute;
            top: 50px;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #f56565;
            border-radius: 10px;
            padding: 15px;
            min-width: 250px;
        }
        
        .admin-menu.active {
            display: block;
        }
        
        .admin-menu h4 {
            color: #f56565;
            margin-bottom: 10px;
        }
        
        .admin-input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            background: rgba(255,255,255,0.1);
            border: 1px solid #4cc9f0;
            border-radius: 5px;
            color: white;
        }
        
        .admin-btn {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            background: #4cc9f0;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- ADMIN PANEL -->
    <div class="admin-panel">
        <button class="admin-toggle" onclick="toggleAdminMenu()">‚öôÔ∏è</button>
        <div class="admin-menu" id="admin-menu">
            <h4>üìÅ File Manager</h4>
            <input type="text" id="hide-code" class="admin-input" placeholder="Code to hide (e.g., 341-01-1)">
            <button class="admin-btn" onclick="hideWorksheet()">Hide Worksheet</button>
            <input type="text" id="show-code" class="admin-input" placeholder="Code to show">
            <button class="admin-btn" onclick="showWorksheet()">Show Worksheet</button>
            <button class="admin-btn" onclick="clearHiddenWorksheets()" style="background: #f56565;">
                Clear All Hidden
            </button>
        </div>
    </div>

    <div class="container">
        <!-- PIN SCREEN -->
        <div id="pin-screen" class="screen active">
            <div class="header">
                <h1>üìö Singapore Curriculum Quiz</h1>
                <p>Enter 6-digit code or select a quiz below</p>
            </div>
            
            <!-- 6-DIGIT PIN DISPLAY -->
            <div class="pin-display">
                <div class="pin-digit" id="digit1">_</div>
                <div class="pin-digit" id="digit2">_</div>
                <div class="pin-digit" id="digit3">_</div>
                <div class="pin-separator">-</div>
                <div class="pin-digit" id="digit4">_</div>
                <div class="pin-digit" id="digit5">_</div>
                <div class="pin-separator">-</div>
                <div class="pin-digit" id="digit6">_</div>
            </div>
            
            <!-- PIN GUIDE -->
            <div class="pin-guide">
                <h4>üìù PIN Format: ABC-DE-F</h4>
                <div class="pin-format">
                    <div class="pin-group">
                        <div class="pin-label"><span>A</span>Level<br>1=Primary<br>2=Lower Sec<br>3=Upper Sec</div>
                        <div class="pin-label"><span>B</span>Subject<br>0=Math<br>1=Sci<br>4=Chem<br>2=Phys</div>
                        <div class="pin-label"><span>C</span>Grade<br>1=P1/S1<br>5=P5<br>2=S2</div>
                        <div class="group-label">Subject Code</div>
                    </div>
                    <div class="pin-group">
                        <div class="pin-label"><span>D</span>Ch<br>10s</div>
                        <div class="pin-label"><span>E</span>Ch<br>1s</div>
                        <div class="group-label">Chapter (01-99)</div>
                    </div>
                    <div class="pin-group">
                        <div class="pin-label"><span>F</span>WS<br>1-9</div>
                        <div class="group-label">Worksheet</div>
                    </div>
                </div>
                <div style="color: #a0aec0; font-size: 0.85rem; text-align: center; margin-top: 10px;">
                    Example: <strong>341-01-1</strong> = Sec 4 Comb Sci Chem, Chapter 10, Worksheet 1
                </div>
            </div>
            
            <!-- HIDDEN WORKSHEETS PANEL -->
            <div id="hidden-worksheets-panel" class="hidden-worksheets" style="display: none;">
                <h4>üîí Hidden Worksheets</h4>
                <div class="hidden-code-list" id="hidden-code-list">
                    <!-- Hidden codes will appear here -->
                </div>
                <button class="show-hidden-btn" onclick="toggleHiddenPanel()">
                    <span>üëÅÔ∏è</span> Show/Hide Hidden Worksheets
                </button>
            </div>
            
            <div class="keypad">
                <button class="keypad-btn" data-digit="1">1</button>
                <button class="keypad-btn" data-digit="2">2</button>
                <button class="keypad-btn" data-digit="3">3</button>
                <button class="keypad-btn" data-digit="4">4</button>
                <button class="keypad-btn" data-digit="5">5</button>
                <button class="keypad-btn" data-digit="6">6</button>
                <button class="keypad-btn" data-digit="7">7</button>
                <button class="keypad-btn" data-digit="8">8</button>
                <button class="keypad-btn" data-digit="9">9</button>
                <button class="keypad-btn" data-digit="0">0</button>
            </div>
            
            <div class="keypad-actions">
                <button id="clear-btn" class="clear-btn">
                    <span style="font-size: 1.3rem;">√ó</span> Clear
                </button>
                <button id="submit-pin-btn" class="submit-btn">
                    GO <span style="font-size: 1.3rem;">‚ñ∂</span>
                </button>
            </div>
            
            <!-- QUIZ CATALOG -->
            <div id="quiz-catalog" class="quiz-catalog">
                <!-- Populated by JavaScript -->
                <div style="text-align: center; color: #a0aec0; padding: 20px;">
                    Loading quiz catalog...
                </div>
            </div>
        </div>
        
        <!-- LOADING SCREEN -->
        <div id="loading-screen" class="screen">
            <div class="loader"></div>
            <div class="loading-text" id="loading-text">Loading questions...</div>
        </div>
        
        <!-- GAME SCREEN -->
        <div id="game-screen" class="screen">
            <div class="game-header">
                <div>
                    <div class="quiz-title" id="quiz-title">Quiz Game</div>
                    <div style="color: #a0aec0; font-size: 0.9rem;" id="quiz-topic">Topic</div>
                </div>
                <button id="home-btn" class="home-btn">üè† Home</button>
            </div>
            
            <div class="players">
                <div class="player active" id="player1">
                    <h3>Player 1</h3>
                    <div class="score" id="score1">0</div>
                </div>
                <div class="player" id="player2">
                    <h3>Player 2</h3>
                    <div class="score" id="score2">0</div>
                </div>
            </div>
            
            <div class="question-info">
                <div>Question: <span id="current-q">1</span>/<span id="total-q">10</span></div>
                <div>Points: <span id="points">10</span></div>
            </div>
            
            <div class="question-box">
                <div class="question" id="question">What is the chemical symbol for water?</div>
                <div class="options" id="options"></div>
                <button id="submit-answer" class="answer-btn" disabled>Submit Answer</button>
                <div class="feedback" id="feedback"></div>
                
                <!-- TREASURE SECTION -->
                <div class="treasure-section" style="display: none;">
                    <h3>üéÅ Treasure Boxes</h3>
                    <p style="color: #a0aec0; margin-bottom: 15px;">Pick one after correct answer!</p>
                    <div class="treasure-boxes">
                        <div class="treasure-box" data-box="1">üéÅ</div>
                        <div class="treasure-box" data-box="2">üéÅ</div>
                    </div>
                </div>
                
                <button id="next-btn" class="next-btn" style="display: none;">Next Question ‚Üí</button>
            </div>
            
            <!-- GAME OVER -->
            <div id="game-over" class="game-over" style="display: none;">
                <h2 style="color: #4cc9f0; margin-bottom: 20px;">üéÆ Game Over!</h2>
                <div style="font-size: 1.2rem; margin-bottom: 20px;">
                    <div>Player 1: <span id="final-score1" style="color: #fbbf24;">0</span> points</div>
                    <div>Player 2: <span id="final-score2" style="color: #fbbf24;">0</span> points</div>
                </div>
                <div style="color: #fbbf24; font-size: 1.5rem; font-weight: bold; margin: 20px 0;" id="winner">
                    üèÜ Winner! üèÜ
                </div>
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button id="restart-game" class="game-over-btn restart-btn" style="background: #4cc9f0; color: white; padding: 12px 20px; border: none; border-radius: 10px; cursor: pointer;">
                        üîÑ Restart
                    </button>
                    <button id="new-chapter" class="game-over-btn new-chapter-btn" style="background: #48bb78; color: white; padding: 12px 20px; border: none; border-radius: 10px; cursor: pointer;">
                        üìö New Chapter
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ERROR SCREEN -->
        <div id="error-screen" class="screen">
            <div class="error-icon">‚ö†Ô∏è</div>
            <h2 style="text-align: center; color: #f56565;">Quiz Not Found</h2>
            <div class="error-text" id="error-message">
                The quiz you're looking for doesn't exist or couldn't be loaded.
            </div>
            <div class="error-actions">
                <button id="retry-btn" class="retry-btn">üîÑ Try Again</button>
                <button id="back-btn" class="back-btn">üè† Back to Home</button>
            </div>
        </div>
    </div>

    <script>
        // ========== GAME STATE ==========
        const gameState = {
            pin: ['', '', '', '', '', ''],
            currentDigit: 0,
            currentQuestion: 0,
            score1: 0,
            score2: 0,
            activePlayer: 1,
            currentQuiz: null,
            questions: [],
            currentTopic: '',
            selectedAnswer: null,
            answered: false,
            hiddenWorksheets: JSON.parse(localStorage.getItem('hiddenWorksheets')) || []
        };

        // ========== HIDDEN WORKSHEETS FUNCTIONS ==========
        function toggleAdminMenu() {
            const menu = document.getElementById('admin-menu');
            menu.classList.toggle('active');
        }

        function hideWorksheet() {
            const code = document.getElementById('hide-code').value.trim();
            if (!code) return;
            
            if (!gameState.hiddenWorksheets.includes(code)) {
                gameState.hiddenWorksheets.push(code);
                localStorage.setItem('hiddenWorksheets', JSON.stringify(gameState.hiddenWorksheets));
                updateHiddenWorksheetsPanel();
                loadQuizCatalog();
                alert(`Worksheet ${code} hidden successfully!`);
                document.getElementById('hide-code').value = '';
            }
        }

        function showWorksheet() {
            const code = document.getElementById('show-code').value.trim();
            if (!code) return;
            
            const index = gameState.hiddenWorksheets.indexOf(code);
            if (index > -1) {
                gameState.hiddenWorksheets.splice(index, 1);
                localStorage.setItem('hiddenWorksheets', JSON.stringify(gameState.hiddenWorksheets));
                updateHiddenWorksheetsPanel();
                loadQuizCatalog();
                alert(`Worksheet ${code} shown again!`);
                document.getElementById('show-code').value = '';
            }
        }

        function clearHiddenWorksheets() {
            if (confirm('Clear all hidden worksheets?')) {
                gameState.hiddenWorksheets = [];
                localStorage.setItem('hiddenWorksheets', JSON.stringify(gameState.hiddenWorksheets));
                updateHiddenWorksheetsPanel();
                loadQuizCatalog();
                alert('All worksheets are now visible!');
            }
        }

        function updateHiddenWorksheetsPanel() {
            const panel = document.getElementById('hidden-worksheets-panel');
            const list = document.getElementById('hidden-code-list');
            
            if (gameState.hiddenWorksheets.length > 0) {
                panel.style.display = 'block';
                list.innerHTML = gameState.hiddenWorksheets.map(code => `
                    <div class="hidden-code-item" onclick="showHiddenCode('${code}')">
                        ${code}
                    </div>
                `).join('');
            } else {
                panel.style.display = 'none';
            }
        }

        function showHiddenCode(code) {
            gameState.pin = code.split('');
            updatePinDisplay();
            submitPin();
        }

        function toggleHiddenPanel() {
            const panel = document.getElementById('hidden-worksheets-panel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Setup keypad
            document.querySelectorAll('.keypad-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (gameState.currentDigit < 6) {
                        const digit = btn.getAttribute('data-digit');
                        gameState.pin[gameState.currentDigit] = digit;
                        updatePinDisplay();
                        gameState.currentDigit++;
                    }
                });
            });

            // Clear button
            document.getElementById('clear-btn').addEventListener('click', () => {
                clearPin();
            });

            // Submit PIN
            document.getElementById('submit-pin-btn').addEventListener('click', submitPin);

            // Home button
            document.getElementById('home-btn').addEventListener('click', () => {
                showScreen('pin');
                clearPin();
            });

            // Submit answer
            document.getElementById('submit-answer').addEventListener('click', checkAnswer);

            // Next button
            document.getElementById('next-btn').addEventListener('click', nextQuestion);

            // Restart game
            document.getElementById('restart-game').addEventListener('click', initGame);

            // New chapter
            document.getElementById('new-chapter').addEventListener('click', () => {
                showScreen('pin');
                clearPin();
            });

            // Error buttons
            document.getElementById('retry-btn').addEventListener('click', submitPin);
            document.getElementById('back-btn').addEventListener('click', () => {
                showScreen('pin');
                clearPin();
            });

            // Treasure boxes
            document.querySelectorAll('.treasure-box').forEach(box => {
                box.addEventListener('click', () => openTreasureBox(box.dataset.box));
            });

            // Keyboard support
            document.addEventListener('keydown', (e) => {
                if (document.getElementById('pin-screen').classList.contains('active')) {
                    if (e.key >= '0' && e.key <= '9') {
                        if (gameState.currentDigit < 6) {
                            gameState.pin[gameState.currentDigit] = e.key;
                            updatePinDisplay();
                            gameState.currentDigit++;
                        }
                    } else if (e.key === 'Backspace') {
                        clearPin();
                    } else if (e.key === 'Enter') {
                        submitPin();
                    }
                }
            });

            // Load catalog
            loadQuizCatalog();
            updateHiddenWorksheetsPanel();
        });

        // ========== SCREEN MANAGEMENT ==========
        function showScreen(screenName) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenName + '-screen').classList.add('active');
        }

        function updatePinDisplay() {
            const digits = ['digit1', 'digit2', 'digit3', 'digit4', 'digit5', 'digit6'];
            digits.forEach((id, index) => {
                const digit = document.getElementById(id);
                digit.textContent = gameState.pin[index] || '_';
            });
        }

        function clearPin() {
            gameState.pin = ['', '', '', '', '', ''];
            gameState.currentDigit = 0;
            updatePinDisplay();
        }

        // ========== LOAD QUIZ CATALOG ==========
        async function loadQuizCatalog() {
            try {
                // Try to load catalog from JSON file
                const response = await fetch('quiz-catalog.json');
                let catalog = [];
                
                if (response.ok) {
                    catalog = await response.json();
                } else {
                    // Generate catalog from available files
                    catalog = await generateCatalog();
                }
                
                // Filter out hidden worksheets
                const visibleCatalog = catalog.filter(quiz => 
                    !gameState.hiddenWorksheets.includes(quiz.code)
                );
                
                displayCatalog(visibleCatalog);
                
            } catch (error) {
                console.error('Failed to load catalog:', error);
                displayDefaultCatalog();
            }
        }

        async function generateCatalog() {
            // This is a simplified version. In production, you'd scan your directory
            const catalog = [
                { code: '341-01-1', name: 'Primary 3 Math Chapter 1', subject: 'Mathematics', grade: 'P3', level: 'primary' },
                { code: '341-01-z', name: 'Primary 3 Math Chapter 1 Bonus', subject: 'Mathematics', grade: 'P3', level: 'primary' },
                { code: '101-01-1', name: 'Primary 1 Math Chapter 1', subject: 'Mathematics', grade: 'P1', level: 'primary' },
                { code: '201-01-1', name: 'Secondary 1 Math Chapter 1', subject: 'Mathematics', grade: 'S1', level: 'secondary' },
                { code: '301-01-1', name: 'Upper Secondary Math Chapter 1', subject: 'Mathematics', grade: 'S3', level: 'upper-secondary' }
            ];
            
            return catalog;
        }

        function displayCatalog(catalog) {
            const catalogDiv = document.getElementById('quiz-catalog');
            
            if (!catalog || catalog.length === 0) {
                catalogDiv.innerHTML = '<div style="color: #a0aec0; text-align: center; padding: 20px;">No quizzes available</div>';
                return;
            }

            // Group by level
            const grouped = catalog.reduce((groups, quiz) => {
                const level = quiz.level || 'other';
                if (!groups[level]) groups[level] = [];
                groups[level].push(quiz);
                return groups;
            }, {});

            let html = '<h3>üìö Available Quizzes</h3>';
            
            // Display each group
            for (const [level, quizzes] of Object.entries(grouped)) {
                const levelName = level.charAt(0).toUpperCase() + level.slice(1);
                const levelColor = level === 'primary' ? '#48bb78' : 
                                 level === 'secondary' ? '#4cc9f0' : 
                                 level === 'upper-secondary' ? '#9f7aea' : '#a0aec0';
                
                html += `
                    <div class="level-section">
                        <div class="level-title" style="color: ${levelColor}">${levelName}</div>
                        <div class="quiz-grid">
                `;
                
                quizzes.forEach(quiz => {
                    const isHidden = gameState.hiddenWorksheets.includes(quiz.code);
                    html += `
                        <div class="quiz-item ${isHidden ? 'hidden' : ''}" data-code="${quiz.code}">
                            <div class="quiz-code">${quiz.code}</div>
                            <div class="quiz-name">${quiz.name}</div>
                            <div class="quiz-meta">${quiz.subject} ‚Ä¢ ${quiz.grade}</div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }

            catalogDiv.innerHTML = html;

            // Add click handlers
            document.querySelectorAll('.quiz-item:not(.hidden)').forEach(item => {
                item.addEventListener('click', () => {
                    const code = item.getAttribute('data-code');
                    gameState.pin = code.split('');
                    updatePinDisplay();
                    submitPin();
                });
            });
        }

        function displayDefaultCatalog() {
            const catalogDiv = document.getElementById('quiz-catalog');
            catalogDiv.innerHTML = `
                <h3>üìö Available Quizzes</h3>
                <div class="level-section">
                    <div class="level-title" style="color: #48bb78">Primary</div>
                    <div class="quiz-grid">
                        <div class="quiz-item" data-code="341-01-1">
                            <div class="quiz-code">341-01-1</div>
                            <div class="quiz-name">Primary 3 Math Chapter 1</div>
                            <div class="quiz-meta">Mathematics ‚Ä¢ P3</div>
                        </div>
                    </div>
                </div>
                <div style="color: #fbbf24; font-size: 0.9rem; text-align: center; margin-top: 15px;">
                    üí° Click on any quiz to auto-fill the code
                </div>
            `;

            document.querySelectorAll('.quiz-item').forEach(item => {
                item.addEventListener('click', () => {
                    const code = item.getAttribute('data-code');
                    gameState.pin = code.split('');
                    updatePinDisplay();
                    submitPin();
                });
            });
        }

        // ========== LOAD QUIZ ==========
        async function submitPin() {
            const pin = gameState.pin.join('');
            if (pin.length !== 6) {
                alert('Please enter all 6 digits');
                return;
            }

            showScreen('loading');
            document.getElementById('loading-text').textContent = `Loading quiz ${pin}...`;

            try {
                // Try multiple file paths
                const paths = [
                    `Questions/primary/math/${pin}.json`,
                    `${pin}.json`,
                    `./${pin}.json`,
                    `Questions/${pin}.json`
                ];

                let quizData = null;
                let foundPath = '';

                for (const path of paths) {
                    try {
                        const response = await fetch(path);
                        if (response.ok) {
                            quizData = await response.json();
                            foundPath = path;
                            break;
                        }
                    } catch (e) {
                        continue;
                    }
                }

                if (!quizData) {
                    // Check if this quiz is hidden
                    if (gameState.hiddenWorksheets.includes(pin)) {
                        throw new Error(`Worksheet ${pin} is hidden. Use admin panel to show it.`);
                    }
                    throw new Error('Quiz file not found');
                }

                console.log(`‚úì Loaded from: ${foundPath}`);
                
                gameState.questions = Array.isArray(quizData.questions) ? quizData.questions : quizData;
                gameState.currentQuestion = 0;
                gameState.score1 = 0;
                gameState.score2 = 0;
                gameState.activePlayer = 1;
                gameState.currentTopic = quizData.topic || quizData.name || pin;
                
                // Update UI
                document.getElementById('quiz-title').textContent = quizData.title || `Quiz: ${pin}`;
                document.getElementById('quiz-topic').textContent = gameState.currentTopic;
                document.getElementById('total-q').textContent = gameState.questions.length;
                
                // Start game
                showQuestion();
                showScreen('game');
                
            } catch (error) {
                console.error('Failed to load quiz:', error);
                document.getElementById('loading-text').textContent = `Error: ${error.message}`;
                
                setTimeout(() => {
                    document.getElementById('error-message').innerHTML = 
                        `<strong>Worksheet ${pin} not found</strong><br><br>
                         <div style="color: #a0aec0; font-size: 0.9rem;">
                         Check if the file exists in: Questions/primary/math/${pin}.json<br>
                         Or the worksheet might be hidden.</div>`;
                    showScreen('error');
                }, 1500);
            }
        }

        // ========== GAME FUNCTIONS ==========
        function showQuestion() {
            const question = gameState.questions[gameState.currentQuestion];
            if (!question) return;

            // Update UI
            document.getElementById('current-q').textContent = gameState.currentQuestion + 1;
            document.getElementById('question').textContent = question.question;
            document.getElementById('points').textContent = question.points || 10;
            
            // Update scores
            document.getElementById('score1').textContent = gameState.score1;
            document.getElementById('score2').textContent = gameState.score2;
            
            // Update active player
            document.getElementById('player1').classList.toggle('active', gameState.activePlayer === 1);
            document.getElementById('player2').classList.toggle('active', gameState.activePlayer === 2);

            // Clear options
            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = '';
            document.getElementById('feedback').innerHTML = '';
            document.getElementById('next-btn').style.display = 'none';
            
            // Hide treasure section
            document.querySelector('.treasure-section').style.display = 'none';
            
            // Reset treasure boxes
            document.querySelectorAll('.treasure-box').forEach(box => {
                box.textContent = 'üéÅ';
                box.style.background = 'linear-gradient(135deg, #fbbf24, #d97706)';
            });

            // Add options
            if (question.options && Array.isArray(question.options)) {
                question.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.textContent = `${String.fromCharCode(65 + index)}) ${option}`;
                    optionDiv.dataset.index = index;
                    
                    optionDiv.addEventListener('click', () => {
                        if (gameState.answered) return;
                        
                        // Clear previous selection
                        document.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        // Select this option
                        optionDiv.classList.add('selected');
                        gameState.selectedAnswer = index;
                        document.getElementById('submit-answer').disabled = false;
                    });
                    
                    optionsDiv.appendChild(optionDiv);
                });
            }

            // Reset submit button
            const submitBtn = document.getElementById('submit-answer');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submit Answer';
            gameState.answered = false;
            gameState.selectedAnswer = null;
        }

        function checkAnswer() {
            if (gameState.answered || gameState.selectedAnswer === null) return;

            gameState.answered = true;
            const question = gameState.questions[gameState.currentQuestion];
            const isCorrect = gameState.selectedAnswer === question.correct;

            // Show feedback
            const feedbackDiv = document.getElementById('feedback');
            if (isCorrect) {
                feedbackDiv.innerHTML = `
                    <div style="color: #48bb78; margin-bottom: 10px;">
                        ‚úÖ Correct! +${question.points || 10} points
                    </div>
                    ${question.explanation ? `<div style="color: #a0aec0;">${question.explanation}</div>` : ''}
                `;
                
                // Update score
                if (gameState.activePlayer === 1) {
                    gameState.score1 += question.points || 10;
                } else {
                    gameState.score2 += question.points || 10;
                }
                
                // Show treasure boxes
                document.querySelector('.treasure-section').style.display = 'block';
                
            } else {
                feedbackDiv.innerHTML = `
                    <div style="color: #f56565; margin-bottom: 10px;">
                        ‚ùå Incorrect. The correct answer is ${String.fromCharCode(65 + question.correct)}
                    </div>
                    ${question.explanation ? `<div style="color: #a0aec0;">${question.explanation}</div>` : ''}
                `;
                
                // Switch player for next question
                gameState.activePlayer = gameState.activePlayer === 1 ? 2 : 1;
                
                // Show next button
                document.getElementById('next-btn').style.display = 'block';
            }

            // Update scores display
            document.getElementById('score1').textContent = gameState.score1;
            document.getElementById('score2').textContent = gameState.score2;

            // Disable options
            document.querySelectorAll('.option').forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
        }

        function openTreasureBox(boxNum) {
            const treasureValue = Math.floor(Math.random() * 20) + 1;
            
            // Update box
            const selectedBox = document.querySelector(`.treasure-box[data-box="${boxNum}"]`);
            selectedBox.textContent = 'üí∞';
            selectedBox.style.background = 'linear-gradient(135deg, #fbbf24, #d97706)';
            
            // Add bonus points
            if (gameState.activePlayer === 1) {
                gameState.score1 += treasureValue;
            } else {
                gameState.score2 += treasureValue;
            }
            
            // Show message
            document.getElementById('feedback').innerHTML += `
                <div style="color: #fbbf24; margin-top: 10px;">
                    üéâ Treasure found! +${treasureValue} bonus points!
                </div>
            `;
            
            // Update scores
            document.getElementById('score1').textContent = gameState.score1;
            document.getElementById('score2').textContent = gameState.score2;
            
            // Disable both boxes
            document.querySelectorAll('.treasure-box').forEach(box => {
                box.style.pointerEvents = 'none';
            });
            
            // Show next button
            document.getElementById('next-btn').style.display = 'block';
        }

        function nextQuestion() {
            gameState.currentQuestion++;
            
            if (gameState.currentQuestion < gameState.questions.length) {
                showQuestion();
            } else {
                endGame();
            }
        }

        function initGame() {
            gameState.currentQuestion = 0;
            gameState.score1 = 0;
            gameState.score2 = 0;
            gameState.activePlayer = 1;
            showQuestion();
            document.getElementById('game-over').style.display = 'none';
        }

        function endGame() {
            const winner = gameState.score1 > gameState.score2 ? 
                'Player 1 Wins! üèÜ' : gameState.score2 > gameState.score1 ? 
                'Player 2 Wins! üèÜ' : 'It\'s a Tie! ü§ù';
            
            document.getElementById('final-score1').textContent = gameState.score1;
            document.getElementById('final-score2').textContent = gameState.score2;
            document.getElementById('winner').textContent = winner;
            
            document.getElementById('game-over').style.display = 'block';
            document.getElementById('next-btn').style.display = 'none';
        }

        // ========== SAMPLE QUIZ DATA (Fallback) ==========
        window.createSampleQuiz = function() {
            const sampleQuiz = {
                title: "Primary 3 Mathematics - Chapter 1",
                topic: "Numbers and Operations",
                questions: [
                    {
                        question: "What is 15 + 27?",
                        options: ["42", "32", "52", "62"],
                        correct: 0,
                        points: 10,
                        explanation: "15 + 27 = 42"
                    },
                    {
                        question: "Which number is the smallest?",
                        options: ["125", "99", "152", "87"],
                        correct: 3,
                        points: 10,
                        explanation: "87 is smaller than 99, 125, and 152"
                    },
                    {
                        question: "What is 8 √ó 7?",
                        options: ["56", "54", "58", "64"],
                        correct: 0,
                        points: 15,
                        explanation: "8 √ó 7 = 56"
                    }
                ]
            };
            
            // Download as JSON
            const dataStr = JSON.stringify(sampleQuiz, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = '341-01-1.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('Sample quiz downloaded! Save it as Questions/primary/math/341-01-1.json');
        };

        // Initialize on load
        setTimeout(() => {
            console.log('Quiz Game Ready!');
            console.log('Admin commands available:');
            console.log('- hideWorksheet(code)');
            console.log('- showWorksheet(code)');
            console.log('- clearHiddenWorksheets()');
            console.log('- createSampleQuiz()');
        }, 1000);
    </script>
</body>
</html>